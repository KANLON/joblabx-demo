<html>
<head>
    <meta charset="UTF-8">
    <title>Export Chart</title>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.2/Chart.bundle.min.js"></script>
</head>

<body>
<canvas id="myChart" width="300" height="300"></canvas>
<button type="button" class="btn btn-primary"><a id="link1" download="ChartPng.png">保存为png</a></button>
<button type="button" class="btn btn-primary"><a id="link2" download="ChartJpg.jpg">保存为jpg</a></button>

<script>




    var ctx = $("#myChart");
    var myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ["Red", "Blue",],
            datasets: [{
                data: [
                    12,
                    19
                ],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                ],
                borderColor: [
                    'rgba(255,99,132,1)',
                    'rgba(54, 162, 235, 1)',
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            title: {display: false, text: 'Statistics Chart',},
            tooltips: {
                mode: 'index', footerFontStyle: 'normal', intersect: false,
                callbacks: {
                    // Use the footer callback to display the sum of the items showing in the tooltip
                    footer: function (tooltipItems, data) {
                        var sum = 0;
                        tooltipItems.forEach(function (tooltipItem) {
                            sum += data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                        });
                        return 'Sum: ' + sum;
                    },
                },
            },
            hover: {mode: 'index', intersect: false,},
            animation: {duration: 0,},
            maintainAspectRatio: false, // control size
        }
    });

    window.onload = function () {
        var ctx = document.getElementById('canvas').getContext('2d');
        // ctx.canvas.width = 200;
        ctx.canvas.height = 700;

        // draw background for saving canvas to image
        var backgroundColor = 'white';
        Chart.plugins.register({
            beforeDraw: function (c) {
                var ctx = c.chart.ctx;
                ctx.fillStyle = backgroundColor;
                ctx.fillRect(0, 0, c.chart.width, c.chart.height);
            },
            afterDatasetsDraw: function (chart) {
                var ctx = chart.ctx;

                chart.data.datasets.forEach(function (dataset, i) {
                    var meta = chart.getDatasetMeta(i);
                    if (!meta.hidden) {
                        meta.data.forEach(function (element, index) {
                            // Draw the text in black, with the specified font
                            ctx.fillStyle = 'rgb(0, 0, 0)';

                            var fontSize = 12;
                            var fontStyle = 'normal';
                            var fontFamily = 'Helvetica Neue';
                            ctx.font = Chart.helpers.fontString(fontSize, fontStyle, fontFamily);

                            // Just naively convert to string for now
                            var dataString = dataset.data[index].toString();

                            // Make sure alignment settings are correct
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';

                            var padding = 5;
                            var position = element.tooltipPosition();
                            ctx.fillText(dataString, position.x, position.y - (fontSize / 2) - padding);
                        });
                    }
                });
            }
        });

        // chart
        window.myLine = new Chart(ctx, config);
        done();
    };

    function done() {
        var url_base64 = document.getElementById("myChart").toDataURL("image/png");
        var url_base64jp = document.getElementById("myChart").toDataURL("image/jpeg");

        link1.href = url_base64;
        link2.href = url_base64jp

        var url = link1.href.replace(/^data:image\/[^;]/, 'data:application/octet-stream');
    }
</script>
</body>
</html>